{% extends "base.j2" %}
{% block title %}<h2>Explore</h2>{% endblock %}

{% block content %}
  {% if leaf %}
      {% if leaf %}
      <a href="{{ request.path|parent }}">Go Back to Month View</a>
      <br>
      {% endif %}
    <br>
    {% for file in files %}
      {% if metadata[request.path[1:] + "/" + file ] %}
      <table style="border: 1px solid black;" width="100%">
          <tr>
              <th style="border: 1px solid black;">Time & Date</th>
              <th style="border: 1px solid black;">Init. #</th>
              <th style="border: 1px solid black;">Recv. #</th>
              <th style="border: 1px solid black;">Incoming?</th>
              <th style="border: 1px solid black;">Duration</th>
              <th style="border: 1px solid black;">Text</th>
          </tr>
          <tr>
              <td style="border: 1px solid black;">{{ metadata[request.path[1:] + "/" + file ]["date_time"]}}</td>
              <td style="border: 1px solid black;">{{ metadata[request.path[1:] + "/" + file ]["initiating"] }}</td>
              <td style="border: 1px solid black;">{{ metadata[request.path[1:] + "/" + file ]["receiving"] }}</td>
              <td style="border: 1px solid black;">{{ metadata[request.path[1:] + "/" + file ]["incoming"] }}</td>
              <td style="border: 1px solid black;">{{ metadata[request.path[1:] + "/" + file ]["duration"] | time_fmt }}</td>
              <td style="border: 1px solid black;">{{ metadata[request.path[1:] + "/" + file ]["text"] }}</td>
          </tr>
      </table>
      <audio controls>
          <source src="{{ (request.path + '/' if request.path != '/' else '') + file }}" type="audio/wav">
          Your browser does not support the audio element.
      </audio>
      {% else %}
      <br>
      Metadata has not yet been gathered.
      {% endif %}
    <br>
    <a href="{{ (request.path + '/' if request.path != '/' else '') + file }}">
        Download recording
    </a>
      {% if not loop.last %}
      <br><br><br>
      {% endif %}
    {% endfor %}
  {% else %}
    <ul>
        {% if not request.path == "/" %}
          <li>
            <a href="{{ request.path|parent }}">..</a>
          </li>
        {% endif %}

        {% for file in files %}
        <li>
            <a href="{{ (request.path + '/' if request.path != '/' else '') + file }}">
                {{ (request.path + '/' if request.path != '/' else '') + file }}
            </a>
        </li>
        {% endfor %}
    </ul>
  {% endif %}
{% endblock %}